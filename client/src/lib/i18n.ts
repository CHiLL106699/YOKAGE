// å¤šèªç³»æ”¯æ´æ¡†æ¶
// æ”¯æ´ç¹é«”ä¸­æ–‡ã€ç°¡é«”ä¸­æ–‡ã€è‹±æ–‡

export type Locale = "zh-TW" | "zh-CN" | "en";

export const defaultLocale: Locale = "zh-TW";

export const locales: { code: Locale; name: string; flag: string }[] = [
  { code: "zh-TW", name: "ç¹é«”ä¸­æ–‡", flag: "ğŸ‡¹ğŸ‡¼" },
  { code: "zh-CN", name: "ç®€ä½“ä¸­æ–‡", flag: "ğŸ‡¨ğŸ‡³" },
  { code: "en", name: "English", flag: "ğŸ‡ºğŸ‡¸" },
];

// ç¿»è­¯å­—å…¸é¡å‹
type TranslationDict = {
  [key: string]: string | TranslationDict;
};

// ç¿»è­¯è³‡æº
const translations: Record<Locale, TranslationDict> = {
  "zh-TW": {
    common: {
      save: "å„²å­˜",
      cancel: "å–æ¶ˆ",
      delete: "åˆªé™¤",
      edit: "ç·¨è¼¯",
      add: "æ–°å¢",
      search: "æœå°‹",
      filter: "ç¯©é¸",
      export: "åŒ¯å‡º",
      import: "åŒ¯å…¥",
      loading: "è¼‰å…¥ä¸­...",
      noData: "æš«ç„¡è³‡æ–™",
      confirm: "ç¢ºèª",
      back: "è¿”å›",
      next: "ä¸‹ä¸€æ­¥",
      previous: "ä¸Šä¸€æ­¥",
      submit: "æäº¤",
      reset: "é‡ç½®",
      close: "é—œé–‰",
      view: "æª¢è¦–",
      download: "ä¸‹è¼‰",
      upload: "ä¸Šå‚³",
      success: "æˆåŠŸ",
      error: "éŒ¯èª¤",
      warning: "è­¦å‘Š",
      info: "è³‡è¨Š",
    },
    nav: {
      dashboard: "å„€è¡¨æ¿",
      customers: "å®¢æˆ¶ç®¡ç†",
      appointments: "é ç´„ç®¡ç†",
      products: "ç”¢å“ç®¡ç†",
      staff: "å“¡å·¥ç®¡ç†",
      reports: "å ±è¡¨åˆ†æ",
      settings: "è¨­å®š",
      billing: "è¨ˆè²»ç®¡ç†",
      notifications: "é€šçŸ¥ç³»çµ±",
      inventory: "åº«å­˜ç®¡ç†",
      orders: "è¨‚å–®ç®¡ç†",
      coupons: "å„ªæƒ åˆ¸",
      aftercare: "è¡“å¾Œé—œæ‡·",
      schedule: "æ’ç­ç®¡ç†",
      attendance: "æ‰“å¡è¨˜éŒ„",
      line: "LINE è¨­å®š",
    },
    customer: {
      title: "å®¢æˆ¶ç®¡ç†",
      name: "å§“å",
      phone: "é›»è©±",
      email: "é›»å­éƒµä»¶",
      birthday: "ç”Ÿæ—¥",
      gender: "æ€§åˆ¥",
      male: "ç”·",
      female: "å¥³",
      other: "å…¶ä»–",
      level: "æœƒå“¡ç­‰ç´š",
      points: "ç©åˆ†",
      totalSpent: "ç´¯è¨ˆæ¶ˆè²»",
      lastVisit: "æœ€å¾Œåˆ°è¨ª",
      notes: "å‚™è¨»",
      tags: "æ¨™ç±¤",
      addCustomer: "æ–°å¢å®¢æˆ¶",
      editCustomer: "ç·¨è¼¯å®¢æˆ¶",
      customerDetail: "å®¢æˆ¶è©³æƒ…",
      consumptionHistory: "æ¶ˆè²»è¨˜éŒ„",
      appointmentHistory: "é ç´„è¨˜éŒ„",
    },
    appointment: {
      title: "é ç´„ç®¡ç†",
      date: "æ—¥æœŸ",
      time: "æ™‚é–“",
      service: "æœå‹™é …ç›®",
      staff: "æœå‹™äººå“¡",
      status: "ç‹€æ…‹",
      pending: "å¾…ç¢ºèª",
      confirmed: "å·²ç¢ºèª",
      completed: "å·²å®Œæˆ",
      cancelled: "å·²å–æ¶ˆ",
      noShow: "æœªåˆ°",
      addAppointment: "æ–°å¢é ç´„",
      editAppointment: "ç·¨è¼¯é ç´„",
      appointmentDetail: "é ç´„è©³æƒ…",
    },
    product: {
      title: "ç”¢å“ç®¡ç†",
      name: "ç”¢å“åç¨±",
      category: "åˆ†é¡",
      price: "åƒ¹æ ¼",
      stock: "åº«å­˜",
      description: "æè¿°",
      status: "ç‹€æ…‹",
      active: "ä¸Šæ¶ä¸­",
      inactive: "å·²ä¸‹æ¶",
      addProduct: "æ–°å¢ç”¢å“",
      editProduct: "ç·¨è¼¯ç”¢å“",
    },
    staff: {
      title: "å“¡å·¥ç®¡ç†",
      name: "å§“å",
      position: "è·ä½",
      department: "éƒ¨é–€",
      phone: "é›»è©±",
      email: "é›»å­éƒµä»¶",
      hireDate: "å…¥è·æ—¥æœŸ",
      status: "ç‹€æ…‹",
      active: "åœ¨è·",
      inactive: "é›¢è·",
      addStaff: "æ–°å¢å“¡å·¥",
      editStaff: "ç·¨è¼¯å“¡å·¥",
    },
    report: {
      title: "å ±è¡¨åˆ†æ",
      revenue: "ç‡Ÿæ”¶å ±è¡¨",
      appointments: "é ç´„çµ±è¨ˆ",
      customers: "å®¢æˆ¶åˆ†æ",
      products: "ç”¢å“éŠ·å”®",
      staff: "å“¡å·¥ç¸¾æ•ˆ",
      daily: "æ—¥å ±",
      weekly: "é€±å ±",
      monthly: "æœˆå ±",
      yearly: "å¹´å ±",
      exportExcel: "åŒ¯å‡º Excel",
      exportPDF: "åŒ¯å‡º PDF",
    },
    notification: {
      title: "é€šçŸ¥ç³»çµ±",
      template: "é€šçŸ¥æ¨¡æ¿",
      schedule: "æ’ç¨‹ä»»å‹™",
      logs: "ç™¼é€è¨˜éŒ„",
      settings: "è¨­å®š",
      appointmentReminder: "é ç´„æé†’",
      aftercare: "è¡“å¾Œé—œæ‡·",
      birthday: "ç”Ÿæ—¥ç¥ç¦",
      followup: "å›è¨ªæé†’",
    },
    billing: {
      title: "è¨ˆè²»ç®¡ç†",
      currentPlan: "ç›®å‰æ–¹æ¡ˆ",
      usage: "ä½¿ç”¨é‡",
      history: "å¸³å–®è¨˜éŒ„",
      payment: "ä»˜æ¬¾æ–¹å¼",
      upgrade: "å‡ç´šæ–¹æ¡ˆ",
      downgrade: "é™ç´šæ–¹æ¡ˆ",
    },
  },
  "zh-CN": {
    common: {
      save: "ä¿å­˜",
      cancel: "å–æ¶ˆ",
      delete: "åˆ é™¤",
      edit: "ç¼–è¾‘",
      add: "æ–°å¢",
      search: "æœç´¢",
      filter: "ç­›é€‰",
      export: "å¯¼å‡º",
      import: "å¯¼å…¥",
      loading: "åŠ è½½ä¸­...",
      noData: "æš‚æ— æ•°æ®",
      confirm: "ç¡®è®¤",
      back: "è¿”å›",
      next: "ä¸‹ä¸€æ­¥",
      previous: "ä¸Šä¸€æ­¥",
      submit: "æäº¤",
      reset: "é‡ç½®",
      close: "å…³é—­",
      view: "æŸ¥çœ‹",
      download: "ä¸‹è½½",
      upload: "ä¸Šä¼ ",
      success: "æˆåŠŸ",
      error: "é”™è¯¯",
      warning: "è­¦å‘Š",
      info: "ä¿¡æ¯",
    },
    nav: {
      dashboard: "ä»ªè¡¨æ¿",
      customers: "å®¢æˆ·ç®¡ç†",
      appointments: "é¢„çº¦ç®¡ç†",
      products: "äº§å“ç®¡ç†",
      staff: "å‘˜å·¥ç®¡ç†",
      reports: "æŠ¥è¡¨åˆ†æ",
      settings: "è®¾ç½®",
      billing: "è®¡è´¹ç®¡ç†",
      notifications: "é€šçŸ¥ç³»ç»Ÿ",
      inventory: "åº“å­˜ç®¡ç†",
      orders: "è®¢å•ç®¡ç†",
      coupons: "ä¼˜æƒ åˆ¸",
      aftercare: "æœ¯åå…³æ€€",
      schedule: "æ’ç­ç®¡ç†",
      attendance: "æ‰“å¡è®°å½•",
      line: "LINE è®¾ç½®",
    },
    customer: {
      title: "å®¢æˆ·ç®¡ç†",
      name: "å§“å",
      phone: "ç”µè¯",
      email: "ç”µå­é‚®ä»¶",
      birthday: "ç”Ÿæ—¥",
      gender: "æ€§åˆ«",
      male: "ç”·",
      female: "å¥³",
      other: "å…¶ä»–",
      level: "ä¼šå‘˜ç­‰çº§",
      points: "ç§¯åˆ†",
      totalSpent: "ç´¯è®¡æ¶ˆè´¹",
      lastVisit: "æœ€ååˆ°è®¿",
      notes: "å¤‡æ³¨",
      tags: "æ ‡ç­¾",
      addCustomer: "æ–°å¢å®¢æˆ·",
      editCustomer: "ç¼–è¾‘å®¢æˆ·",
      customerDetail: "å®¢æˆ·è¯¦æƒ…",
      consumptionHistory: "æ¶ˆè´¹è®°å½•",
      appointmentHistory: "é¢„çº¦è®°å½•",
    },
    appointment: {
      title: "é¢„çº¦ç®¡ç†",
      date: "æ—¥æœŸ",
      time: "æ—¶é—´",
      service: "æœåŠ¡é¡¹ç›®",
      staff: "æœåŠ¡äººå‘˜",
      status: "çŠ¶æ€",
      pending: "å¾…ç¡®è®¤",
      confirmed: "å·²ç¡®è®¤",
      completed: "å·²å®Œæˆ",
      cancelled: "å·²å–æ¶ˆ",
      noShow: "æœªåˆ°",
      addAppointment: "æ–°å¢é¢„çº¦",
      editAppointment: "ç¼–è¾‘é¢„çº¦",
      appointmentDetail: "é¢„çº¦è¯¦æƒ…",
    },
    product: {
      title: "äº§å“ç®¡ç†",
      name: "äº§å“åç§°",
      category: "åˆ†ç±»",
      price: "ä»·æ ¼",
      stock: "åº“å­˜",
      description: "æè¿°",
      status: "çŠ¶æ€",
      active: "ä¸Šæ¶ä¸­",
      inactive: "å·²ä¸‹æ¶",
      addProduct: "æ–°å¢äº§å“",
      editProduct: "ç¼–è¾‘äº§å“",
    },
    staff: {
      title: "å‘˜å·¥ç®¡ç†",
      name: "å§“å",
      position: "èŒä½",
      department: "éƒ¨é—¨",
      phone: "ç”µè¯",
      email: "ç”µå­é‚®ä»¶",
      hireDate: "å…¥èŒæ—¥æœŸ",
      status: "çŠ¶æ€",
      active: "åœ¨èŒ",
      inactive: "ç¦»èŒ",
      addStaff: "æ–°å¢å‘˜å·¥",
      editStaff: "ç¼–è¾‘å‘˜å·¥",
    },
    report: {
      title: "æŠ¥è¡¨åˆ†æ",
      revenue: "è¥æ”¶æŠ¥è¡¨",
      appointments: "é¢„çº¦ç»Ÿè®¡",
      customers: "å®¢æˆ·åˆ†æ",
      products: "äº§å“é”€å”®",
      staff: "å‘˜å·¥ç»©æ•ˆ",
      daily: "æ—¥æŠ¥",
      weekly: "å‘¨æŠ¥",
      monthly: "æœˆæŠ¥",
      yearly: "å¹´æŠ¥",
      exportExcel: "å¯¼å‡º Excel",
      exportPDF: "å¯¼å‡º PDF",
    },
    notification: {
      title: "é€šçŸ¥ç³»ç»Ÿ",
      template: "é€šçŸ¥æ¨¡æ¿",
      schedule: "æ’ç¨‹ä»»åŠ¡",
      logs: "å‘é€è®°å½•",
      settings: "è®¾ç½®",
      appointmentReminder: "é¢„çº¦æé†’",
      aftercare: "æœ¯åå…³æ€€",
      birthday: "ç”Ÿæ—¥ç¥ç¦",
      followup: "å›è®¿æé†’",
    },
    billing: {
      title: "è®¡è´¹ç®¡ç†",
      currentPlan: "å½“å‰æ–¹æ¡ˆ",
      usage: "ä½¿ç”¨é‡",
      history: "è´¦å•è®°å½•",
      payment: "ä»˜æ¬¾æ–¹å¼",
      upgrade: "å‡çº§æ–¹æ¡ˆ",
      downgrade: "é™çº§æ–¹æ¡ˆ",
    },
  },
  en: {
    common: {
      save: "Save",
      cancel: "Cancel",
      delete: "Delete",
      edit: "Edit",
      add: "Add",
      search: "Search",
      filter: "Filter",
      export: "Export",
      import: "Import",
      loading: "Loading...",
      noData: "No data",
      confirm: "Confirm",
      back: "Back",
      next: "Next",
      previous: "Previous",
      submit: "Submit",
      reset: "Reset",
      close: "Close",
      view: "View",
      download: "Download",
      upload: "Upload",
      success: "Success",
      error: "Error",
      warning: "Warning",
      info: "Info",
    },
    nav: {
      dashboard: "Dashboard",
      customers: "Customers",
      appointments: "Appointments",
      products: "Products",
      staff: "Staff",
      reports: "Reports",
      settings: "Settings",
      billing: "Billing",
      notifications: "Notifications",
      inventory: "Inventory",
      orders: "Orders",
      coupons: "Coupons",
      aftercare: "Aftercare",
      schedule: "Schedule",
      attendance: "Attendance",
      line: "LINE Settings",
    },
    customer: {
      title: "Customer Management",
      name: "Name",
      phone: "Phone",
      email: "Email",
      birthday: "Birthday",
      gender: "Gender",
      male: "Male",
      female: "Female",
      other: "Other",
      level: "Member Level",
      points: "Points",
      totalSpent: "Total Spent",
      lastVisit: "Last Visit",
      notes: "Notes",
      tags: "Tags",
      addCustomer: "Add Customer",
      editCustomer: "Edit Customer",
      customerDetail: "Customer Detail",
      consumptionHistory: "Consumption History",
      appointmentHistory: "Appointment History",
    },
    appointment: {
      title: "Appointment Management",
      date: "Date",
      time: "Time",
      service: "Service",
      staff: "Staff",
      status: "Status",
      pending: "Pending",
      confirmed: "Confirmed",
      completed: "Completed",
      cancelled: "Cancelled",
      noShow: "No Show",
      addAppointment: "Add Appointment",
      editAppointment: "Edit Appointment",
      appointmentDetail: "Appointment Detail",
    },
    product: {
      title: "Product Management",
      name: "Product Name",
      category: "Category",
      price: "Price",
      stock: "Stock",
      description: "Description",
      status: "Status",
      active: "Active",
      inactive: "Inactive",
      addProduct: "Add Product",
      editProduct: "Edit Product",
    },
    staff: {
      title: "Staff Management",
      name: "Name",
      position: "Position",
      department: "Department",
      phone: "Phone",
      email: "Email",
      hireDate: "Hire Date",
      status: "Status",
      active: "Active",
      inactive: "Inactive",
      addStaff: "Add Staff",
      editStaff: "Edit Staff",
    },
    report: {
      title: "Reports",
      revenue: "Revenue Report",
      appointments: "Appointment Statistics",
      customers: "Customer Analysis",
      products: "Product Sales",
      staff: "Staff Performance",
      daily: "Daily",
      weekly: "Weekly",
      monthly: "Monthly",
      yearly: "Yearly",
      exportExcel: "Export Excel",
      exportPDF: "Export PDF",
    },
    notification: {
      title: "Notifications",
      template: "Templates",
      schedule: "Scheduled Tasks",
      logs: "Send Logs",
      settings: "Settings",
      appointmentReminder: "Appointment Reminder",
      aftercare: "Aftercare",
      birthday: "Birthday Wishes",
      followup: "Follow-up Reminder",
    },
    billing: {
      title: "Billing",
      currentPlan: "Current Plan",
      usage: "Usage",
      history: "Billing History",
      payment: "Payment Methods",
      upgrade: "Upgrade",
      downgrade: "Downgrade",
    },
  },
};

// ç²å–ç¿»è­¯
export function t(key: string, locale: Locale = defaultLocale): string {
  const keys = key.split(".");
  let result: string | TranslationDict = translations[locale];

  for (const k of keys) {
    if (typeof result === "object" && result !== null && k in result) {
      result = result[k];
    } else {
      // å¦‚æœæ‰¾ä¸åˆ°ç¿»è­¯ï¼Œè¿”å› key æœ¬èº«
      return key;
    }
  }

  return typeof result === "string" ? result : key;
}

// æ ¼å¼åŒ–æ—¥æœŸ
export function formatDate(date: Date | string, locale: Locale = defaultLocale): string {
  const d = typeof date === "string" ? new Date(date) : date;
  
  const localeMap: Record<Locale, string> = {
    "zh-TW": "zh-TW",
    "zh-CN": "zh-CN",
    en: "en-US",
  };

  return d.toLocaleDateString(localeMap[locale], {
    year: "numeric",
    month: "2-digit",
    day: "2-digit",
  });
}

// æ ¼å¼åŒ–è²¨å¹£
export function formatCurrency(amount: number, locale: Locale = defaultLocale): string {
  const currencyMap: Record<Locale, { currency: string; locale: string }> = {
    "zh-TW": { currency: "TWD", locale: "zh-TW" },
    "zh-CN": { currency: "CNY", locale: "zh-CN" },
    en: { currency: "USD", locale: "en-US" },
  };

  const { currency, locale: formatLocale } = currencyMap[locale];

  return new Intl.NumberFormat(formatLocale, {
    style: "currency",
    currency,
    minimumFractionDigits: 0,
    maximumFractionDigits: 0,
  }).format(amount);
}

// æ ¼å¼åŒ–æ•¸å­—
export function formatNumber(num: number, locale: Locale = defaultLocale): string {
  const localeMap: Record<Locale, string> = {
    "zh-TW": "zh-TW",
    "zh-CN": "zh-CN",
    en: "en-US",
  };

  return new Intl.NumberFormat(localeMap[locale]).format(num);
}
